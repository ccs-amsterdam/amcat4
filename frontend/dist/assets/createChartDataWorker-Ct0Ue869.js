(function(){"use strict";const w=["hsl(var(--secondary))","hsl(var(--primary))","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#e41a1c","#999999","#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3","#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f","#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666","#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666","#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928","#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2","#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"];function S(e){return e<3&&(e=3),w.slice(0,e)}function M(e,r){const t=e.meta.axes.map(n=>n.name),l=e.meta.aggregations.length>0&&e.meta.aggregations[0].name||"n",o=e.meta.axes[0].interval;let s=e.data,c=[l];if(t.length>1){const n=D(e.data,e.meta.axes[0],e.meta.axes[1],l,o);s=n.rows,c=n.columnNames}const{columns:f,domain:u}=N(s,c);return s=A(s,t[0],o,c),e.meta.axes[0].interval?s=s.map(n=>k(n,e.meta.axes[0])).sort((n,a)=>n._sort-a._sort).map(n=>{const{_sort:a,...i}=n;return i}):r&&(s=s.sort((n,a)=>{let i=0,b=0;for(const m of f)i+=Number(n[m.name])||0,b+=Number(a[m.name])||0;return b-i})),{rows:s,columns:f,domain:u,axes:e.meta.axes,aggregations:e.meta.aggregations}}function D(e,r,t,l,o){const s=a=>t.interval&&E(t.interval)?p(a,t.interval).label:a,c=Array.from(new Set(e.map(a=>String(s(a[t.name]))))),f=new Map(e.map(a=>[JSON.stringify([a[r.name],s(a[t.name])]),Number(a[l])]));let u=Array.from(new Set(e.map(a=>String(a[r.name]))));return o==="year"&&(u=g(u,o)),{rows:u.map(a=>{const i={[r.name]:a};return c.forEach(b=>{const m=JSON.stringify([a,b]);i[b]=f.get(m)??0}),i}),columnNames:c}}function N(e,r){const t=S(r.length),l=Number(e[0][r[0]]),o=[l,l];return{columns:r.map((c,f)=>{let u=0;for(const n of e){const a=Number(n[c]);u+=a,a>o[1]&&(o[1]=a),a<o[0]&&(o[0]=a)}return{name:c,sum:u,color:t[f%t.length]}}),domain:o}}function d(e){const r=t=>String(t).padStart(2,"0");return`${e.getFullYear()}-${r(e.getMonth()+1)}-${r(e.getDate())}`}function A(e,r,t,l){if(!t)return e;const o=Object.fromEntries(l.map(f=>[f,0]));if(["year","quarter","month","week","day"].includes(t)){const f=new Map(e.map(n=>[d(new Date(n[r])),n]));return g(e.map(n=>String(n[r])),t).map(n=>f.get(n)||{[r]:n,...o})}function s(f,u){const n=new Map(f.map(a=>[String(a[r]),a]));return u.map(a=>n.get(a)||{[r]:a,...o})}if(t==="monthnr")return s(e,[..._.keys()]);if(t==="dayofweek")return s(e,[...y.keys()]);if(t==="daypart")return s(e,[...h.keys()]);function c(f,u=!1){const n=f.map(m=>Number(m[r])).filter(m=>!isNaN(m));if(n.length===0)return[];let a=Math.min(...n),i=Math.max(...n);u&&(a=Math.floor(a/10)*10,i=Math.floor(i/10)*10);const b=[];for(let m=a;m<=i;u?m+=10:m++)b.push(String(m));return b}return t==="yearnr"?s(e,c(e,!1)):t==="decade"?s(e,c(e,!0)):e}function T(e,r){const t=e.getFullYear(),l=e.getMonth(),o=e.getDate();switch(r){case"year":return new Date(t+1,l,o);case"quarter":return new Date(t,l+3,o);case"month":return new Date(t,l+1,o);case"week":return new Date(t,l,o+7);case"day":return new Date(t,l,o+1);default:throw new Error(`Can't handle interval ${r}, sorry!`)}}function g(e,r){if(r==="monthnr")return e;const t=[],l=e.map(c=>new Date(c));if(e.length===0)return t;let o=l.reduce((c,f)=>c<f?c:f);const s=l.reduce((c,f)=>c>f?c:f);for(;o<=s;)t.push(d(o)),o=T(o,r);return t}const y=new Map([["Monday",{label:"Monday",_sort:1}],["Tuesday",{label:"Tuesday",_sort:2}],["Wednesday",{label:"Wednesday",_sort:3}],["Thursday",{label:"Thursday",_sort:4}],["Friday",{label:"Friday",_sort:5}],["Saturday",{label:"Saturday",_sort:6}],["Sunday",{label:"Sunday",_sort:7}]]),h=new Map([["Morning",{label:"Morning",_sort:1}],["Afternoon",{label:"Afternoon",_sort:2}],["Evening",{label:"Evening",_sort:3}],["Night",{label:"Night",_sort:4}]]),_=new Map([["1",{label:"January",_sort:1}],["2",{label:"February",_sort:2}],["3",{label:"March",_sort:3}],["4",{label:"April",_sort:4}],["5",{label:"May",_sort:5}],["6",{label:"June",_sort:6}],["7",{label:"July",_sort:7}],["8",{label:"August",_sort:8}],["9",{label:"September",_sort:9}],["10",{label:"October",_sort:10}],["11",{label:"November",_sort:11}],["12",{label:"December",_sort:12}]]);function p(e,r){const t={label:String(e),_sort:0};switch(r){case"dayofweek":return y.get(String(e))||t;case"daypart":return h.get(String(e))||t;case"monthnr":return _.get(String(e))||t;default:return t}}function k(e,r){const t=p(e[r.name],r.interval);return{...e,[r.name]:t.label,_sort:t._sort}}function E(e){return e?["dayofweek","daypart","monthnr"].includes(e):!1}self.onmessage=e=>{try{const r=M(e.data.data,e.data.sorted);self.postMessage({status:"success",chartData:r})}catch{self.postMessage({status:"error",chartData:void 0})}}})();
